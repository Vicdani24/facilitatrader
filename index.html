<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Análise de Jogos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #1b1b1b, #333);
      color: white;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    .game {
      background: #444;
      border-radius: 8px;
      margin: 20px auto;
      padding: 20px;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }
    .market {
      margin: 10px 0;
      font-weight: bold;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #555;
      color: white;
    }
    button:hover {
      background-color: #666;
    }
  </style>
</head>
<body>
  <h1>Análise de Jogos</h1>
  <div id="games">Carregando jogos...</div>

  <button id="loadButton">Carregar Jogos</button>
  <button id="clearButton">Apagar Lista</button>

  <script>
    const apiKey = "eec454bd8e0651ad7b01e6a08e9bf96b";
    const apiUrl = "https://v3.football.api-sports.io";
    const headers = {
      "X-RapidAPI-Host": "v3.football.api-sports.io",
      "X-RapidAPI-Key": apiKey,
    };

    const gamesDiv = document.getElementById("games");
    const loadButton = document.getElementById("loadButton");
    const clearButton = document.getElementById("clearButton");

    async function fetchGames() {
      const today = new Date().toISOString().split("T")[0];
      try {
        const response = await fetch(`${apiUrl}/fixtures?date=${today}`, { headers });
        const data = await response.json();

        if (!data.response || data.response.length === 0) {
          gamesDiv.innerHTML = "<p>Não há jogos hoje.</p>";
          return;
        }

        gamesDiv.innerHTML = "";

        // Processar cada jogo individualmente
        for (const fixture of data.response) {
          const { league, teams } = fixture;

          // Filtrar ligas relevantes
          const relevantLeagues = [39, 61, 135, 140, 78, 2, 3];
          if (!relevantLeagues.includes(league.id)) continue;

          const homeResults = await fetchLastResults(teams.home.id);
          const awayResults = await fetchLastResults(teams.away.id);

          const markets = analyzeMarkets(homeResults, awayResults);

          const gameDiv = document.createElement("div");
          gameDiv.className = "game";
          gameDiv.innerHTML = `
            <p><strong>${teams.home.name} vs ${teams.away.name}</strong></p>
            ${markets.length ? markets.join("") : "<p>Nenhum mercado relevante.</p>"}
          `;
          gamesDiv.appendChild(gameDiv);
        }
      } catch (error) {
        console.error("Erro ao buscar jogos:", error);
        gamesDiv.innerHTML = "<p>Erro ao carregar os jogos.</p>";
      }
    }

    async function fetchLastResults(teamId) {
      try {
        const response = await fetch(
          `${apiUrl}/fixtures?team=${teamId}&last=5&status=FT`,
          { headers }
        );
        const data = await response.json();
        return data.response.map(match => ({
          homeGoals: match.goals.home,
          awayGoals: match.goals.away,
        }));
      } catch (error) {
        console.error("Erro ao buscar resultados:", error);
        return [];
      }
    }

    function analyzeMarkets(homeResults, awayResults) {
      const totalGames = homeResults.length + awayResults.length;

      const analyzeGoals = (threshold) =>
        homeResults.filter(match => match.homeGoals + match.awayGoals >= threshold).length +
        awayResults.filter(match => match.homeGoals + match.awayGoals >= threshold).length;

      const bothTeamsScore = (results) =>
        results.filter(match => match.homeGoals > 0 && match.awayGoals > 0).length;

      const markets = [];

      if (analyzeGoals(1.5) >= 7) markets.push('<p class="market">+1.5 Gols</p>');
      if (analyzeGoals(2.5) >= 7) markets.push('<p class="market">+2.5 Gols</p>');
      if (analyzeGoals(3.5) >= 7) markets.push('<p class="market">+3.5 Gols</p>');
      if (analyzeGoals(-3.5) >= 7) markets.push('<p class="market">-3.5 Gols</p>');
      if (analyzeGoals(-2.5) >= 7) markets.push('<p class="market">-2.5 Gols</p>');

      if (bothTeamsScore(homeResults) + bothTeamsScore(awayResults) >= 7) {
        markets.push('<p class="market">Ambas Marcam</p>');
      }

      return markets;
    }

    function clearGames() {
      gamesDiv.innerHTML = "";
    }

    loadButton.addEventListener("click", fetchGames);
    clearButton.addEventListener("click", clearGames);
  </script>
</body>
</html>
